<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Update Form</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<form id="updateForm">
    <input type="hidden" id="recordId" name="recordId">
    <input type="text" id="fullName" name="fullName" placeholder="Full Name" required><br>
    <input type="email" id="workEmail" name="workEmail" placeholder="Work Email" required><br>
    <input type="text" id="jobTitleOrDepartment" name="jobTitleOrDepartment" placeholder="Job Title/Department" required><br>
    <input type="text" id="phoneNumber" name="phoneNumber" placeholder="Phone Number" required><br>
    <input type="text" id="companyName" name="companyName" placeholder="Company Name" required><br>
    <input type="text" id="companySize" name="companySize" placeholder="Company Size" required><br>
    <textarea id="howCanOurTeamHelpYou" name="howCanOurTeamHelpYou" placeholder="How Can Our Team Help You?" required></textarea><br>
    <input type="text" id="prefill" name="prefill" placeholder="Prefill" required><br>
    <input type="text" id="stage" name="stage" placeholder="Stage" required><br>
    <input type="text" id="visitRecords" name="visitRecords" placeholder="Visit Records (Comma-separated)" required><br>
    <button type="submit">Update</button>
</form>

<script>
    $(document).ready(function() {
        // Assume you have the JSON response
        var response = {
            "total": 1,
            "records": [
                {
                    "recordId": "recqtPNLSxThI",
                    "createdAt": 1723118795000,
                    "updatedAt": 1723525825000,
                    "fields": {
                        "workEmail": "email@example.com",
                        "phoneNumber": "1 555-123-4567",
                        "Created time": 1723118795209,
                        "jobTitleOrDepartment": "Administration Specialist",
                        "companySize": "20-49",
                        "visitRecords": [
                            "recYLQNHjxFAA",
                            "rec7WLOh4GwCM"
                        ],
                        "companyName": "Example Ltd.",
                        "prefill": "pricing_page",
                        "fullName": "Edward Thompson",
                        "Last edited time": 1723466168222,
                        "stage": "Initiate Contact"
                    }
                }
            ]
        };

        // Extract the record
        var record = response.records[0];

        // Populate the form fields
        $('#recordId').val(record.recordId);
        $('#fullName').val(record.fields.fullName);
        $('#workEmail').val(record.fields.workEmail);
        $('#jobTitleOrDepartment').val(record.fields.jobTitleOrDepartment);
        $('#phoneNumber').val(record.fields.phoneNumber);
        $('#companyName').val(record.fields.companyName);
        $('#companySize').val(record.fields.companySize);
        $('#howCanOurTeamHelpYou').val(record.fields.howCanOurTeamHelpYou);
        $('#prefill').val(record.fields.prefill);
        $('#stage').val(record.fields.stage);
        $('#visitRecords').val(record.fields.visitRecords.join(','));

        // Handle the form submission
        $('#updateForm').submit(function(event) {
            event.preventDefault();

            var formData = {
                "recordId": $('#recordId').val(),
                "fields": {
                    "fullName": $('#fullName').val(),
                    "workEmail": $('#workEmail').val(),
                    "jobTitleOrDepartment": $('#jobTitleOrDepartment').val(),
                    "phoneNumber": $('#phoneNumber').val(),
                    "companyName": $('#companyName').val(),
                    "companySize": $('#companySize').val(),
                    "howCanOurTeamHelpYou": $('#howCanOurTeamHelpYou').val(),
                    "prefill": $('#prefill').val(),
                    "stage": $('#stage').val(),
                    "visitRecords": $('#visitRecords').val().split(',')
                }
            };

            $.ajax({
                url: "https://aitable.ai/fusion/v1/datasheets/dst3rQvu2QspumWDpp/records/" + formData.recordId,
                type: "PUT",
                headers: {
                    "Authorization": "Bearer _Paste_Your_API_Token_",
                    "Content-Type": "application/json"
                },
                data: JSON.stringify(formData),
                success: function(response) {
                    alert('Data updated successfully!');
                },
                error: function(error) {
                    alert('Failed to update data.');
                }
            });
        });
    });
</script>
</body>
</html>
